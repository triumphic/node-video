var responseTool = {
    tool: require('./tool'),
    /*返回服务端异常*/
    sendServerException: function (res, mess) {
        res.send(500, mess || '服务端错误请查看后台日志');
    },
    /*返回拒绝访问*/
    sendDecline: function (res, mess) {
        res.send(405, mess || '服务端拒绝访问');
    },
    /*返回数据更新、上传、下载成功*/
    sendSuccess: function (res, param) {
        param = param || {};
        res.set('Content-Type', 'text/json;charset=utf-8');
        res.send(param);
    },
    /*只针对ajax请求向浏览器端返回重定向
    *302 在IE上有问题。所以改用自定义的700状态码
    */
    sendRedirect: function (res, url) {
        res.header('location', url);
        res.send(700);
    },
    /*登录请求的响应
    *result:{
        isLogin:true,  //为true时代表登录成功，否则登录失败
        loginFailedType:1,  //登录失败原因， 1 用户名或密码错误  2 用户名不存在  3 密码错误  4 该用户已被停用
        puser:{}            //用户信息
    *}
    */
    loginResponse: function (req, res, result) {
        var isLogin = result.isLogin || false;
        if (isLogin) {
            var origionLoginTime = +new Date();
            var loginTime = this.tool.cipher(origionLoginTime);
            var ticket = this.tool.cipher(req.sessionID);

            res.header("P3P", "CP='IDC DSP COR CURa ADMa  OUR IND PHY ONL COM STA'");
            res.cookie(this.tool.loginTimeName, loginTime, { httpOnly: true });
            res.cookie(this.tool.ticketName, ticket, { httpOnly: true });
            req.session[this.tool.loginTimeName] = origionLoginTime;
            var user = result.puser || {};
            user[this.tool.loginTimeName] = origionLoginTime;
            req.session[this.tool.userSessionName] = user;
            res.redirect('/');
            return;
        }
        this.renderLogin(res, result.loginFailedType || 1);
    },
    /*登录成功后，渲染主页面*/
    renderMain: function (res, user) {
        var firstUrl = (user.authorizations[0] || {}).virtualUrl;
        return firstUrl ? res.redirect(firstUrl) :
            res.render('layout', {
                host: commonLibUrl,
                user: user || {},
                noaccess: '/' + pconst.requestType.noaccess
            });
    },
    /*渲染登录页面*/
    renderLogin: function (res, err) {
        res.render('login', { host: commonLibUrl, err: err });
    },
    /*跳转到首页*/
    redirectMain: function (res) {
        res.redirect('/');
    }
};

module.exports = responseTool;