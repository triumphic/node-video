//定时清理本地服务器上的无用附件---无用的定义：半小时前创建的文件
function clearFile(uploadPath) {
    var fs = require('fs');
    fs.exists(uploadPath, function (isExists) {
        if (!isExists) fs.mkdir(uploadPath);
    });

    setTimeout(function () {
        var currHour = new Date().getHours();
        var filesArr = fs.readdirSync(uploadPath);
        var currTime = new Date().getTime();
        var halfHourTime = 1000 * 60 * 30;
        for (var i = 0; i < filesArr.length; i++) {
            var currPath = uploadPath + '/' + filesArr[i];
            var stat = fs.lstatSync(currPath);
            var birthtimeMs = stat.birthtimeMs;
            if (currTime - birthtimeMs < halfHourTime) continue;
            if (stat.isFile() === true)
                fs.unlinkSync(currPath);
        }
        clearFile(uploadPath);
    }, 1000 * 60 * 60);
};

var process = require('process');

process.on('message', function (m) {
    var uploadPath = m.uploadPath;
    clearFile(uploadPath);
});